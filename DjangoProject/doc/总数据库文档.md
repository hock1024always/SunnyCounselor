# 咨询师系统总数据库设计

## 用户认证模块

### 1. 用户基础表 (users)

| 字段名       | 类型                      | 约束                       | 说明       |
| ------------ | ------------------------- | -------------------------- | ---------- |
| id           | BIGINT                    | PRIMARY KEY AUTO_INCREMENT | 用户唯一ID |
| username     | VARCHAR(50)               | UNIQUE NOT NULL            | 用户名     |
| email        | VARCHAR(100)              | UNIQUE                     | 邮箱地址   |
| phone        | VARCHAR(20)               | UNIQUE                     | 手机号     |
| password     | VARCHAR(128)              | NOT NULL                   | 加密密码   |
| user_type    | ENUM('admin','counselor') | NOT NULL                   | 用户类型   |
| gender       | ENUM('男','女')           |                            | 性别       |
| avatar       | VARCHAR(500)              |                            | 头像URL    |
| status       | ENUM('active','inactive') | DEFAULT 'active'           | 用户状态   |
| created_time | DATETIME                  | DEFAULT CURRENT_TIMESTAMP  | 创建时间   |

**外键关系：**

- 无

**支持的查询方式：**

- 用户名
- 邮箱
- 手机号
- 用户类型
- 状态

### 2. 咨询师详情表 (counselor_profiles)

| 字段名             | 类型         | 约束                             | 说明         |
| ------------------ | ------------ | -------------------------------- | ------------ |
| id                 | BIGINT       | PRIMARY KEY AUTO_INCREMENT       | 主键ID       |
| user_id            | BIGINT       | FOREIGN KEY REFERENCES users(id) | 关联用户ID   |
| name               | VARCHAR(50)  | NOT NULL                         | 真实姓名     |
| organization       | VARCHAR(100) |                                  | 所属机构     |
| introduction       | TEXT         |                                  | 个人介绍     |
| experience         | TEXT         |                                  | 从业经验     |
| expertise          | JSON         |                                  | 擅长领域数组 |
| education          | VARCHAR(200) |                                  | 教育背景     |
| certifications     | TEXT         |                                  | 资质证书     |
| consultation_count | INT          | DEFAULT 0                        | 咨询次数     |
| created_time       | DATETIME     | DEFAULT CURRENT_TIMESTAMP        | 创建时间     |

**外键关系：**

- `user_id`→ `users(id)`

**支持的查询方式：**

- 姓名
- 所属机构

### 3. 管理员详情表 (admin_profiles)

| 字段名       | 类型                                   | 约束                             | 说明       |
| ------------ | -------------------------------------- | -------------------------------- | ---------- |
| id           | BIGINT                                 | PRIMARY KEY AUTO_INCREMENT       | 主键ID     |
| user_id      | BIGINT                                 | FOREIGN KEY REFERENCES users(id) | 关联用户ID |
| department   | VARCHAR(100)                           |                                  | 所属部门   |
| role         | ENUM('super_admin','admin','operator') | DEFAULT 'operator'               | 角色权限   |
| created_time | DATETIME                               | DEFAULT CURRENT_TIMESTAMP        | 创建时间   |

**外键关系：**

- `user_id`→ `users(id)`

## 咨询管理模块

### 4. 咨询档案主表 (consultation_records)

| 字段名                  | 类型                                | 约束                             | 说明               |
| ----------------------- | ----------------------------------- | -------------------------------- | ------------------ |
| id                      | BIGINT                              | PRIMARY KEY AUTO_INCREMENT       | 主键ID             |
| record_no               | VARCHAR(20)                         | UNIQUE NOT NULL                  | 档案编号           |
| client_name             | VARCHAR(50)                         | NOT NULL                         | 来访者姓名         |
| client_type             | ENUM('student','adult')             | DEFAULT 'student'                | 来访者类型         |
| gender                  | ENUM('男','女')                     | NOT NULL                         | 性别               |
| age                     | INT                                 |                                  | 年龄               |
| student_id              | VARCHAR(50)                         |                                  | 学籍号(学生类型)   |
| school                  | VARCHAR(100)                        |                                  | 学校               |
| grade                   | VARCHAR(20)                         |                                  | 年级               |
| class_name              | VARCHAR(20)                         |                                  | 班级               |
| education               | VARCHAR(50)                         |                                  | 教育程度(成人类型) |
| occupation              | VARCHAR(50)                         |                                  | 职业(成人类型)     |
| contact                 | VARCHAR(100)                        |                                  | 联系方式           |
| emergency_contact_name  | VARCHAR(50)                         |                                  | 紧急联系人姓名     |
| emergency_contact_phone | VARCHAR(20)                         |                                  | 紧急联系人电话     |
| referral_source         | VARCHAR(200)                        |                                  | 咨询来源           |
| main_complaint          | TEXT                                |                                  | 主诉问题           |
| consultation_goal       | TEXT                                |                                  | 咨询目标           |
| counselor_id            | BIGINT                              | FOREIGN KEY REFERENCES users(id) | 负责咨询师ID       |
| interview_count         | INT                                 | DEFAULT 0                        | 总访谈次数         |
| current_status          | ENUM('active','completed','closed') | DEFAULT 'active'                 | 档案状态           |
| created_by              | BIGINT                              | FOREIGN KEY REFERENCES users(id) | 创建人ID           |
| created_time            | DATETIME                            | DEFAULT CURRENT_TIMESTAMP        | 创建时间           |

**外键关系：**

- `counselor_id`→ `users(id)`
- `created_by`→ `users(id)`

**支持的查询方式：**

- 来访者姓名
- 学校
- 年级
- 班级
- 咨询师ID
- 档案状态

### 5. 咨询访谈详情表 (consultation_sessions)

| 字段名                    | 类型                                      | 约束                                            | 说明           |
| ------------------------- | ----------------------------------------- | ----------------------------------------------- | -------------- |
| id                        | BIGINT                                    | PRIMARY KEY AUTO_INCREMENT                      | 主键ID         |
| record_id                 | BIGINT                                    | FOREIGN KEY REFERENCES consultation_records(id) | 档案ID         |
| session_number            | INT                                       | NOT NULL                                        | 第几次访谈     |
| interview_date            | DATE                                      | NOT NULL                                        | 访谈日期       |
| interview_time            | VARCHAR(50)                               |                                                 | 访谈时间       |
| duration                  | INT                                       |                                                 | 访谈时长(分钟) |
| visit_status              | ENUM('scheduled','completed','cancelled') | DEFAULT 'scheduled'                             | 访谈状态       |
| objective_description     | TEXT                                      |                                                 | 客观描述       |
| doctor_evaluation         | TEXT                                      |                                                 | 医生评定       |
| follow_up_plan            | TEXT                                      |                                                 | 后续计划       |
| next_visit_plan           | TEXT                                      |                                                 | 下次访谈计划   |
| crisis_status             | VARCHAR(50)                               |                                                 | 危机状态       |
| consultant_name           | VARCHAR(50)                               |                                                 | 咨询师姓名     |
| is_third_party_evaluation | BOOLEAN                                   | DEFAULT FALSE                                   | 是否为他评     |
| signature_image           | VARCHAR(500)                              |                                                 | 签名图片URL    |
| created_by                | BIGINT                                    | FOREIGN KEY REFERENCES users(id)                | 创建人ID       |
| created_time              | DATETIME                                  | DEFAULT CURRENT_TIMESTAMP                       | 创建时间       |

**外键关系：**

- `record_id`→ `consultation_records(id)`
- `created_by`→ `users(id)`

**唯一约束：**

- `(record_id, session_number)`确保同一档案的访谈次数唯一

### 6. 咨询订单表 (consultation_orders)

| 字段名              | 类型                                                         | 约束                                            | 说明           |
| ------------------- | ------------------------------------------------------------ | ----------------------------------------------- | -------------- |
| id                  | BIGINT                                                       | PRIMARY KEY AUTO_INCREMENT                      | 主键ID         |
| order_no            | VARCHAR(30)                                                  | UNIQUE NOT NULL                                 | 订单编号       |
| record_id           | BIGINT                                                       | FOREIGN KEY REFERENCES consultation_records(id) | 关联档案ID     |
| counselor_id        | BIGINT                                                       | FOREIGN KEY REFERENCES users(id)                | 咨询师ID       |
| service_type        | ENUM('online','offline')                                     | NOT NULL                                        | 服务类型       |
| counseling_keywords | JSON                                                         |                                                 | 咨询关键词数组 |
| appointment_date    | DATE                                                         | NOT NULL                                        | 预约日期       |
| time_slot           | VARCHAR(50)                                                  | NOT NULL                                        | 预约时段       |
| contact_info        | VARCHAR(100)                                                 |                                                 | 联系方式       |
| status              | ENUM('pending','accepted','completed','cancelled','rejected') | DEFAULT 'pending'                               | 订单状态       |
| submit_time         | DATETIME                                                     | DEFAULT CURRENT_TIMESTAMP                       | 提交时间       |
| accept_time         | DATETIME                                                     |                                                 | 接单时间       |
| end_time            | DATETIME                                                     |                                                 | 结束时间       |
| created_time        | DATETIME                                                     | DEFAULT CURRENT_TIMESTAMP                       | 创建时间       |

**外键关系：**

- `record_id`→ `consultation_records(id)`
- `counselor_id`→ `users(id)`

**支持的查询方式：**

- 咨询师ID
- 订单状态
- 预约日期
- 服务类型

## 干预管理模块

### 7. 负面事件表 (negative_events)

| 字段名        | 类型                                   | 约束                                            | 说明       |
| ------------- | -------------------------------------- | ----------------------------------------------- | ---------- |
| id            | BIGINT                                 | PRIMARY KEY AUTO_INCREMENT                      | 主键ID     |
| record_id     | BIGINT                                 | FOREIGN KEY REFERENCES consultation_records(id) | 关联档案ID |
| event_details | TEXT                                   | NOT NULL                                        | 事件详情   |
| event_date    | DATE                                   | NOT NULL                                        | 事件日期   |
| event_level   | ENUM('low','medium','high','critical') | DEFAULT 'medium'                                | 事件等级   |
| handled_by    | BIGINT                                 | FOREIGN KEY REFERENCES users(id)                | 处理人ID   |
| disabled      | BOOLEAN                                | DEFAULT FALSE                                   | 是否禁用   |
| created_by    | BIGINT                                 | FOREIGN KEY REFERENCES users(id)                | 创建人ID   |
| created_time  | DATETIME                               | DEFAULT CURRENT_TIMESTAMP                       | 创建时间   |

**外键关系：**

- `record_id`→ `consultation_records(id)`
- `handled_by`→ `users(id)`
- `created_by`→ `users(id)`

**支持的查询方式：**

- 档案ID
- 事件日期
- 处理人ID

### 8. 转介单位表 (referral_units)

| 字段名        | 类型                      | 约束                             | 说明     |
| ------------- | ------------------------- | -------------------------------- | -------- |
| id            | BIGINT                    | PRIMARY KEY AUTO_INCREMENT       | 主键ID   |
| unit_name     | VARCHAR(100)              | NOT NULL                         | 单位名称 |
| address       | VARCHAR(200)              |                                  | 地址     |
| contact_phone | VARCHAR(20)               |                                  | 联系电话 |
| status        | ENUM('active','inactive') | DEFAULT 'active'                 | 状态     |
| created_by    | BIGINT                    | FOREIGN KEY REFERENCES users(id) | 创建人ID |
| created_time  | DATETIME                  | DEFAULT CURRENT_TIMESTAMP        | 创建时间 |

**外键关系：**

- `created_by`→ `users(id)`

**支持的查询方式：**

- 单位名称
- 状态

### 9. 转介记录表 (referral_records)

| 字段名              | 类型         | 约束                                            | 说明        |
| ------------------- | ------------ | ----------------------------------------------- | ----------- |
| id                  | BIGINT       | PRIMARY KEY AUTO_INCREMENT                      | 主键ID      |
| record_id           | BIGINT       | FOREIGN KEY REFERENCES consultation_records(id) | 关联档案ID  |
| referral_unit_id    | BIGINT       | FOREIGN KEY REFERENCES referral_units(id)       | 转介单位ID  |
| referral_reason     | TEXT         | NOT NULL                                        | 转介原因    |
| referral_date       | DATE         | NOT NULL                                        | 转介日期    |
| referral_attachment | VARCHAR(500) |                                                 | 转介附件URL |
| created_by          | BIGINT       | FOREIGN KEY REFERENCES users(id)                | 创建人ID    |
| created_time        | DATETIME     | DEFAULT CURRENT_TIMESTAMP                       | 创建时间    |

**外键关系：**

- `record_id`→ `consultation_records(id)`
- `referral_unit_id`→ `referral_units(id)`
- `created_by`→ `users(id)`

**支持的查询方式：**

- 档案ID
- 转介单位ID

## 健康宣教模块

### 10. 宣教栏目表 (education_categories)

| 字段名        | 类型                      | 约束                             | 说明     |
| ------------- | ------------------------- | -------------------------------- | -------- |
| id            | BIGINT                    | PRIMARY KEY AUTO_INCREMENT       | 主键ID   |
| category_name | VARCHAR(50)               | NOT NULL                         | 栏目名称 |
| sort_order    | INT                       | DEFAULT 0                        | 栏目顺序 |
| status        | ENUM('active','inactive') | DEFAULT 'active'                 | 状态     |
| created_by    | BIGINT                    | FOREIGN KEY REFERENCES users(id) | 创建人ID |
| created_time  | DATETIME                  | DEFAULT CURRENT_TIMESTAMP        | 创建时间 |

**外键关系：**

- `created_by`→ `users(id)`

**支持的查询方式：**

- 栏目名称
- 状态

### 11. 宣教资讯表 (education_articles)

| 字段名        | 类型                    | 约束                                            | 说明     |
| ------------- | ----------------------- | ----------------------------------------------- | -------- |
| id            | BIGINT                  | PRIMARY KEY AUTO_INCREMENT                      | 主键ID   |
| category_id   | BIGINT                  | FOREIGN KEY REFERENCES education_categories(id) | 栏目ID   |
| title         | VARCHAR(200)            | NOT NULL                                        | 资讯标题 |
| content       | TEXT                    | NOT NULL                                        | 资讯内容 |
| article_type  | ENUM('article','video') | DEFAULT 'article'                               | 资讯类型 |
| video_url     | VARCHAR(500)            |                                                 | 视频URL  |
| author        | VARCHAR(50)             |                                                 | 作者     |
| collect_count | INT                     | DEFAULT 0                                       | 收藏人数 |
| like_count    | INT                     | DEFAULT 0                                       | 点赞人数 |
| read_count    | INT                     | DEFAULT 0                                       | 阅读人数 |
| is_published  | BOOLEAN                 | DEFAULT FALSE                                   | 发布状态 |
| created_by    | BIGINT                  | FOREIGN KEY REFERENCES users(id)                | 创建人ID |
| created_time  | DATETIME                | DEFAULT CURRENT_TIMESTAMP                       | 创建时间 |

**外键关系：**

- `category_id`→ `education_categories(id)`
- `created_by`→ `users(id)`

**支持的查询方式：**

- 栏目ID
- 发布状态
- 创建时间

### 12. 通知公告表 (notifications)

| 字段名       | 类型         | 约束                             | 说明     |
| ------------ | ------------ | -------------------------------- | -------- |
| id           | BIGINT       | PRIMARY KEY AUTO_INCREMENT       | 主键ID   |
| title        | VARCHAR(200) | NOT NULL                         | 通知标题 |
| content      | TEXT         | NOT NULL                         | 通知内容 |
| is_published | BOOLEAN      | DEFAULT FALSE                    | 发布状态 |
| created_by   | BIGINT       | FOREIGN KEY REFERENCES users(id) | 创建人ID |
| created_time | DATETIME     | DEFAULT CURRENT_TIMESTAMP        | 创建时间 |

**外键关系：**

- `created_by`→ `users(id)`

**支持的查询方式：**

- 发布状态
- 通知标题

### 13. 轮播图表 (banners)

| 字段名       | 类型                      | 约束                             | 说明        |
| ------------ | ------------------------- | -------------------------------- | ----------- |
| id           | BIGINT                    | PRIMARY KEY AUTO_INCREMENT       | 主键ID      |
| module       | VARCHAR(50)               | NOT NULL                         | 模块名称    |
| image_urls   | JSON                      | NOT NULL                         | 图片URL数组 |
| sort_order   | INT                       | DEFAULT 0                        | 排序        |
| status       | ENUM('active','inactive') | DEFAULT 'active'                 | 状态        |
| created_by   | BIGINT                    | FOREIGN KEY REFERENCES users(id) | 创建人ID    |
| created_time | DATETIME                  | DEFAULT CURRENT_TIMESTAMP        | 创建时间    |

**外键关系：**

- `created_by`→ `users(id)`

**支持的查询方式：**

- 模块名称
- 状态

## 排班管理模块

### 14. 咨询师排班表 (counselor_schedules)

| 字段名           | 类型     | 约束                             | 说明         |
| ---------------- | -------- | -------------------------------- | ------------ |
| id               | BIGINT   | PRIMARY KEY AUTO_INCREMENT       | 主键ID       |
| counselor_id     | BIGINT   | FOREIGN KEY REFERENCES users(id) | 咨询师ID     |
| schedule_date    | DATE     | NOT NULL                         | 排班日期     |
| time_slots       | JSON     | NOT NULL                         | 时间段数组   |
| max_appointments | INT      | DEFAULT 5                        | 最大预约数   |
| available_slots  | INT      | DEFAULT 5                        | 剩余可预约数 |
| created_time     | DATETIME | DEFAULT CURRENT_TIMESTAMP        | 创建时间     |

**外键关系：**

- `counselor_id`→ `users(id)`

**唯一约束：**

- `(counselor_id, schedule_date)`确保咨询师同一天只有一个排班记录

**支持的查询方式：**

- 咨询师ID
- 排班日期

### 15. 停诊记录表 (counselor_absences)

| 字段名       | 类型                                        | 约束                             | 说明     |
| ------------ | ------------------------------------------- | -------------------------------- | -------- |
| id           | BIGINT                                      | PRIMARY KEY AUTO_INCREMENT       | 主键ID   |
| counselor_id | BIGINT                                      | FOREIGN KEY REFERENCES users(id) | 咨询师ID |
| absence_type | ENUM('sick_leave','personal_leave','other') | DEFAULT 'personal_leave'         | 停诊类型 |
| start_time   | DATETIME                                    | NOT NULL                         | 开始时间 |
| end_time     | DATETIME                                    | NOT NULL                         | 结束时间 |
| reason       | TEXT                                        |                                  | 停诊原因 |
| status       | ENUM('pending','approved')                  | DEFAULT 'pending'                | 状态     |
| created_time | DATETIME                                    | DEFAULT CURRENT_TIMESTAMP        | 创建时间 |

**外键关系：**

- `counselor_id`→ `users(id)`

**支持的查询方式：**

- 咨询师ID
- 开始时间
- 结束时间
- 状态

## 交互与反馈模块

### 16. 咨询评价表 (consultation_reviews)

| 字段名       | 类型     | 约束                                           | 说明      |
| ------------ | -------- | ---------------------------------------------- | --------- |
| id           | BIGINT   | PRIMARY KEY AUTO_INCREMENT                     | 主键ID    |
| order_id     | BIGINT   | FOREIGN KEY REFERENCES consultation_orders(id) | 订单ID    |
| counselor_id | BIGINT   | FOREIGN KEY REFERENCES users(id)               | 咨询师ID  |
| rating       | INT      | NOT NULL CHECK (rating >= 1 AND rating <= 5)   | 评分(1-5) |
| content      | TEXT     |                                                | 评价内容  |
| created_time | DATETIME | DEFAULT CURRENT_TIMESTAMP                      | 创建时间  |

**外键关系：**

- `order_id`→ `consultation_orders(id)`
- `counselor_id`→ `users(id)`

**支持的查询方式：**

- 咨询师ID
- 订单ID

## 文件管理模块

### 17. 文件存储表 (file_storage)

| 字段名        | 类型         | 约束                             | 说明       |
| ------------- | ------------ | -------------------------------- | ---------- |
| id            | BIGINT       | PRIMARY KEY AUTO_INCREMENT       | 主键ID     |
| file_name     | VARCHAR(255) | NOT NULL                         | 文件名     |
| file_path     | VARCHAR(500) | NOT NULL                         | 文件路径   |
| file_size     | BIGINT       | NOT NULL                         | 文件大小   |
| file_type     | VARCHAR(100) | NOT NULL                         | 文件类型   |
| module        | VARCHAR(50)  | NOT NULL                         | 所属模块   |
| associated_id | BIGINT       |                                  | 关联记录ID |
| uploader_id   | BIGINT       | FOREIGN KEY REFERENCES users(id) | 上传者ID   |
| created_time  | DATETIME     | DEFAULT CURRENT_TIMESTAMP        | 创建时间   |

**外键关系：**

- `uploader_id`→ `users(id)`

**支持的查询方式：**

- 所属模块
- 关联记录ID
- 上传者ID